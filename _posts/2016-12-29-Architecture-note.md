---
layout: post
title: 体系结构(5)
categories: Architecture
description: 体系结构
keywords: 体系结构
---

# 体系结构(5)

功能需求可以不写

### 体系结构的目标：

1. 将需求转为设计
2. 增强系统的健壮性
3. ​和环境相匹配

需求和体系结构的开发其实是并发的。

体系结构主要解决：

1. 质量问题
2. 可行性问题

《实用软件体系结构》

用例驱动，需求驱动

### 体系结构包括（源头）：

1. 概要功能需求（作业里可以大概写一下）
2. 质量属性要求
3. 项目环境 （可以使用 checklist ）
4. 商业目标（作业里可以大概写一下）
5. （包含）约束
6. 系统质量+技术环境+开发环境+商业环境+（功能）=关注点

### 一般场景方法（按 PPT 写即可）





### 第二步 定义初始体系结构

### 第三步 建立体系结构演化过程

作业里要交设计决策 和 带来的改动

可扩展性，实行封装

注重决策过程





部件（包）设计原则：

**复用发布等价原则 REP**（一个包能够恰好被复用，packaeg是发布的单位，也是复用的单位）

**共同封闭原则 CCP** 

**共同复用原则 CRP** 包内的类要用就全用，不用就都不用

**单向依赖 DAG** 形成无环依赖

​	破环1: 将一个包分为2个

​	破坏2:使用接口，可能需要一个 Factory（在第3个包中）

**稳定依赖**（依赖倒置）依赖稳定的借口，而不是变化的类





### 部署设计（服务器选购指南） 貌似不考

#### 容量

预估：

1. 运行年限

2. 每年有多少业务

3. 每个业务占多少Bytes？（考虑数据库索引，日志，备份）

   Y\*BT\*B=硬盘容量

#### 网络

以高峰期吞吐计算

1. 并发用户数
2. 用户请求数
3. 每次传输的Bytes

User\*Request\*Bytes/0.75     为网络留出空余

#### CPU

以峰值计算

TPC-C

TPM：每分钟处理事务数

TPM==TASK\* 80% \* S x F / (T \* C)

#### 内存

现在不用考虑了





## Tactics 和 策略：

### 故障检测

**Ping／Echo** ：使用某个模块周期 ping 那些需要检测的服务器端口

**心跳算法**：服务器主动告知监听者（负载均衡）可以新增monitor，也可以新增端口。Connector：HeartBeat

**异常**：错误编码（使用编码树）

**投票算法**（防黑客攻击）：多个服务器同时处理一个请求—>投票决策—>某个服务器返回值不对头—>检查服务器

**热备份**：两台机器同时运行，一台为主，一台可以做备份，

**冷备份（镜像）**：1 台机器，2个存储，解决存储故障

**Spare**：配置文件使用多份，配置失败时使用上一个配置版本

**安全模式**：

**状态同步**：从 log 恢复 利用 Command Pattern

Checkpoint：从 checkpoint  回滚

动态移除部件

利用 数据库的 transaction 思想





### 可修改性：

- 修改控制在局部
- 防止连锁反应
- 延迟绑定

publish — 接口对外服务

**使用中介**

**延迟绑定**： 

1.   运行时注册
2.   配置文件（反射机制）
3.   多态
4.   依靠协议






### 性能

减少计算负载（剔除不必要的计算）

控制事件频率（网络通信，计算）

控制采样的频率（取数据的频率，牺牲实时性）

使用冗余提升效率

改变调度算法





### 安全

1. 抵制攻击
   - 验证用户
   - 授权 新增component 修改 connector 
   - 数据加密
   - 限制访问
   - 限制暴露：暴露出的东西十分有限，需要多个host同时解锁才能打开
2. 检测攻击
   - 安全检测，记录访问痕迹，和 攻击 pattern 比对。记录单个 session 的ip，系统，时间间隔，浏览器
3. 从攻击中恢复
   - 可靠性。。。。（冗余，日志。。）
   - Audit trail 记录用户使用痕迹（更多的是研究用户行为）

### 可测试性

1. 控制输入输出
   - 记录用户的输入输出， 处理 Procedure Call
   - 分离接口和实现  新增 TestBus 组件  对每一个接口多实现一个 stub 用于测试
   - 秘籍！使用秘籍来测试软件 —> 检测有没有特殊路径的使用
2. 内部监控











​	



